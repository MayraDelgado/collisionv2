(function(n,require,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=require("../../vanillaExtension/vanilla"),u=require("./waiting"),f=require("../browser"),r=require("../task"),e=function(){function n(n){var t=this;this.task=r.resolved();this.pageName="helpGuide";this.dashboardPageName="dashboard";this.langHeading={de:{editGuide:"https://docs.google.com/document/edit?id=1_Zq3Yb2A7pkWzo2uIxZFD1fFtQwQ2uK2gRP90F6UAVA",groups:"h.1baon6m",exceptions:"h.40ew0vw",drivers:"h.4iylrwe",liveMaps:"h.1y810tw"},en:{editGuide:"https://docs.google.com/document/edit?id=14GNbMq_ZKSUpkmSdJ8ws-DyO4P_HmTYOIu3k52f7KKY",groups:"h.lrjj9liedfcq",exceptions:"h.oazgncxiby1h",drivers:"h.qajstl20lc0k",liveMaps:"h.ke5p0mjaguzn"},es:{editGuide:"https://docs.google.com/document/edit?id=1wFU4aWqaynb0ykLT8AoHNixWPQ-NLvSyIghvCjEZE58",groups:"h.4k668n3",exceptions:"h.kgcv8k",drivers:"h.2nusc19",liveMaps:"h.2jxsxqh"},fr:{editGuide:"https://docs.google.com/document/edit?id=15WwtYXPiV_NE5VRFhzkv1kZHKGbCffZPXBvPrYaNG40",groups:"h.2zbgiuw",exceptions:"h.34g0dwd",drivers:"h.3mzq4wv",liveMaps:"h.2jxsxqh"},it:{editGuide:"https://docs.google.com/document/edit?id=12fYopimeA-4oE8tKJGMHYPmfSPl_mR38IuOPbynQWmU",groups:"h.lrjj9liedfcq",exceptions:"h.oazgncxiby1h",drivers:"h.qajstl20lc0k",liveMaps:"h.ke5p0mjaguzn"},ja:{editGuide:"https://docs.google.com/document/edit?id=19NT96EJ4m4FdDGOEoG_MyaCmboyKmysivV2yFv4O1uc",groups:"h.2dlolyb",exceptions:"h.2iq8gzs",drivers:"h.319y80a",liveMaps:"h.ew4a6skxg59w"},nl:{editGuide:"https://docs.google.com/document/edit?id=1s4bOgSUkzX-sdT3w_C3N5CRzLoC5ZGEu2iWWWIGS_bk",groups:"h.1opuj5n",exceptions:"h.36ei31r",drivers:"h.4h042r0",liveMaps:"h.44sinio"},pl:{editGuide:"https://docs.google.com/document/edit?id=1BSj79Ny_YAoGa8o3UeUTuCOZ7PFe0g_oHz4TqNSC6ao",groups:"h.3vac5uf",exceptions:"h.3s49zyc",drivers:"h.xvir7l",liveMaps:"h.1ksv4uv"},"pt-BR":{editGuide:"https://docs.google.com/document/edit?id=1DTpw9fNHWlmqHOnE60cmx_-YdztnGsw53PM0AnmtynQ",groups:"h.39kk8xu",exceptions:"h.36ei31r",drivers:"h.4h042r0",liveMaps:"h.44sinio"},"zh-Hans":{editGuide:"https://docs.google.com/document/edit?id=1tsZHuVTg74pYgo8XHkJLRE9EZVl1G3779sn9PF3IF7M",groups:"h.lrjj9liedfcq",exceptions:"h.oazgncxiby1h",drivers:"h.qajstl20lc0k",liveMaps:"h.ke5p0mjaguzn"}};this.waiting=u.default(n.els.helpGuideId.parentNode);this.uiConfig=n.shared.context.uiConfiguration;this.canEditUserSettings=this.uiConfig.acl&&this.uiConfig.acl.indexOf("UserSettings")!==-1;this.context=n.shared.context;this.language=n.shared.localizer.getCultureInfo().language;this.url=this.getUrl(this.language,n.shared.connection.token.database);this.iframe=n.els.helpGuide_iframe;this.heading=n.els.heading;this.helpGuideDefaultPageHelp=n.els.helpGuide_defaultPageHelp;this.helpGuideShowYes=n.els.helpGuide_ShowYes;this.helpGuideShowNo=n.els.helpGuide_ShowNo;this.setIframeToLoad();this.canEditUserSettings?(this.helpGuideShowYes.addEventListener("click",function(){t.toggleHelpGuideDefaultPageHelp(n.els.helpGuide_toolbar,!1);n.shared.gotoPage(t.pageName)},!1),this.helpGuideShowNo.addEventListener("click",function(){var r=n.shared.entitiesLoader;r.users.getItemById(t.context.currentUser.id).then(function(n){var u=i.extend({},n);return u.defaultPage=t.dashboardPageName,r.users.setItem(u)});t.helpGuideDefaultPageHelp.style.display="none";n.shared.gotoPage(t.dashboardPageName)},!1)):this.helpGuideDefaultPageHelp.style.display="none"}return n.prototype.toggleHelpGuideDefaultPageHelp=function(n,t){i.toggleClasses(n,"hideHelpToolbar",!t)},n.prototype.setIframeToLoad=function(){var t=this,n=this.iframe.src;(!n||n.indexOf("blank")>-1)&&(this.iframe.addEventListener("load",function(){t.iframeLoaderHandler()},!1),this.iframe.setAttribute("src",this.url),this.task&&this.task.abort(),this.task=r.default("LoadingHelpGuide"),this.waiting.displayProgress(this.task))},n.prototype.iframeLoaderHandler=function(){var n=this,t,i,r;setTimeout(function(){n.iframe.style.display="block";n.heading&&Object.keys(n.langHeading.en).indexOf(n.heading)>-1&&n.iframe.setAttribute("src",n.url+"#"+(n.langHeading[n.language]||n.langHeading.en)[n.heading])},5);this.task.resolve();this.iframe.removeEventListener("load",function(){n.iframeLoaderHandler()},!1);t=window.device;f.default().isWebViewApp()&&t&&t.platform==="iOS"&&this.iframe.contentDocument&&(i=this.iframe.contentDocument.querySelectorAll("a[target='_blank']"),r=[].slice.call(i),r.forEach(function(n){n.addEventListener("click",function(t){t.preventDefault();window.open(n.href,"_system")},!0)}))},n.prototype.getUrl=function(n,t){return"/productGuide/"+(["de","en","es","fr","it","ja","nl","pl","pt-BR","zh-Hans"].indexOf(n)>-1?n:"en")+"/index.html?db="+t},n.prototype.initialize=function(n,t){t.shared.localizer.translatePage(t.els.helpGuideId,function(){t.els.helpGuideId.style.display="block";n()})},n.prototype.focus=function(n){var t=!!(this.canEditUserSettings&&this.context.currentUser.defaultPage===this.pageName&&location.hash.indexOf(this.pageName)===-1);this.toggleHelpGuideDefaultPageHelp(n.els.helpGuide_toolbar,t);i.addClasses(document.body,"new-ui");this.setIframeToLoad()},n.prototype.blur=function(){i.removeClasses(document.body,"new-ui");this.task.abort()},n.prototype.onCultureInfoChange=function(){},n}();t.default=e})(geotab,geotab.commonjs.generateRequire("geotab.checkmate.ui.helpGuide"),geotab.commonjs.generateExport("geotab.checkmate.ui.helpGuide"));self.geotab && geotab.declare("geotab.checkmate.ui.helpGuide");
